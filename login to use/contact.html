<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Contact Us - RFID Attendance System</title>
  <!-- Tailwind CSS -->
  <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
  <link rel="icon" type="image/x-icon" href="fst.png">
  <!-- Google Material Icons -->
  <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200">
  <!-- Firebase SDK -->
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
  <!-- Custom CSS -->
  <link rel="stylesheet" href="home.css">
  <link rel="stylesheet" href="menu.css">
  <link rel="stylesheet" href="sharedcss.css">
  <script src="theme.js"></script>
  <!-- EmailJS SDK -->
  <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/@emailjs/browser@3/dist/email.min.js"></script>
  <script type="text/javascript">
    (function() {
      // Initialize EmailJS with your user ID
      emailjs.init("u9e3vubXd2NhJG9jY"); // Replace with your actual User ID
    })();
  </script>
</head>
<body class="bg-gray-100 dark:bg-gray-900">
  <!-- Sliding Menu -->
  <div class="menu">
    <ul class="menu-content">
      <li><a href="home1.html"><span class="material-symbols-outlined">home</span><span>Home</span></a></li>
      <li><a href="dashboard.html"><span class="material-symbols-outlined">dashboard</span><span>Dashboard</span></a></li>
      <li><a href="explore.html"><span class="material-symbols-outlined">explore</span><span>Explore</span></a></li>
      <li><a href="analytics.html"><span class="material-symbols-outlined">analytics</span><span>Analytics</span></a></li>
      <li><a href="settings.html"><span class="material-symbols-outlined">settings</span><span>Settings</span></a></li>
      <li><a href="profile.html"><span class="material-symbols-outlined">person</span><span>Account</span></a></li>
      <li><a href="report.html"><span class="material-symbols-outlined">report</span><span>Report</span></a></li>
      <li><a href="contact.html" class="active"><span class="material-symbols-outlined">email</span><span>Contact</span></a></li>
      <li><a href="#" id="menu-logout"><span class="material-symbols-outlined">logout</span><span>Logout</span></a></li>
    </ul>
  </div>

  <!-- Top Navigation -->
  <nav class="bg-white dark:bg-gray-800 shadow-md">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
      <div class="flex justify-between h-16">
        <div class="flex">
          <div class="flex-shrink-0 flex items-center">
            <img class="h-8 w-auto" src="fst.png" alt="Logo">
            <span class="ml-2 text-xl font-bold text-gray-800 dark:text-white">RFID Attendance System</span>
          </div>
        </div>
        <div class="flex items-center">
          <div class="relative ml-3">
            <div>
              <button id="user-menu-btn" class="max-w-xs flex items-center text-sm rounded-full focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500">
                <span class="sr-only">Open user menu</span>
                <img id="user-avatar" class="h-8 w-8 rounded-full object-cover" src="fst.png" alt="User avatar">
              </button>
            </div>
            <div id="user-menu-dropdown" class="hidden origin-top-right absolute right-0 mt-2 w-48 rounded-md shadow-lg py-1 bg-white dark:bg-gray-800 ring-1 ring-black ring-opacity-5 focus:outline-none z-10">
              <div class="px-4 py-2 border-b border-gray-200 dark:border-gray-700">
                <p id="menu-user-name" class="text-sm font-medium text-gray-900 dark:text-white">John Smith</p>
                <p id="menu-user-email" class="text-xs text-gray-500 dark:text-gray-400">john.smith@example.com</p>
                <span id="menu-user-role" class="mt-1 inline-block px-2 py-0.5 text-xs font-medium rounded-full bg-blue-100 text-blue-800 dark:bg-blue-900 dark:text-blue-200">Student</span>
              </div>
              <a href="profile.html" class="block px-4 py-2 text-sm text-gray-700 dark:text-gray-200 hover:bg-gray-100 dark:hover:bg-gray-700">Your Profile</a>
              <a href="settings.html" class="block px-4 py-2 text-sm text-gray-700 dark:text-gray-200 hover:bg-gray-100 dark:hover:bg-gray-700">Settings</a>
              <button id="logout-btn" class="w-full text-left px-4 py-2 text-sm text-gray-700 dark:text-gray-200 hover:bg-gray-100 dark:hover:bg-gray-700 focus:outline-none">Sign out</button>
            </div>
          </div>
        </div>
      </div>
    </div>
  </nav>

  <!-- Main Content -->
  <div class="max-w-7xl mx-auto py-6 sm:px-6 lg:px-8">
    <div class="px-4 py-6 sm:px-0">
      <div class="flex items-center justify-between mb-6">
        <h1 class="text-2xl font-bold text-gray-900 dark:text-white">Contact Us</h1>
      </div>

      <!-- Contact Information -->
      <div class="bg-white dark:bg-gray-800 shadow overflow-hidden sm:rounded-lg mb-6">
        <div class="px-4 py-5 sm:px-6">
          <h2 class="text-lg leading-6 font-medium text-gray-900 dark:text-white">Contact Information</h2>
          <p class="mt-1 max-w-2xl text-sm text-gray-500 dark:text-gray-400">Reach out to our support team for any questions or issues.</p>
        </div>
        <div class="border-t border-gray-200 dark:border-gray-700">
          <div class="grid grid-cols-1 md:grid-cols-3 gap-4 p-6">
            <div class="bg-gray-50 dark:bg-gray-700 p-4 rounded-lg">
              <div class="flex items-center mb-3">
                <span class="material-symbols-outlined text-blue-500 mr-2">mail</span>
                <h3 class="font-medium text-gray-900 dark:text-white">Email</h3>
              </div>
              <p class="text-sm text-gray-600 dark:text-gray-300">islem.bouslah@etudiant-fst.utm.tn</p>
              <p class="text-sm text-gray-500 dark:text-gray-400 mt-1">For general inquiries and support</p>
            </div>
            
            <div class="bg-gray-50 dark:bg-gray-700 p-4 rounded-lg">
              <div class="flex items-center mb-3">
                <span class="material-symbols-outlined text-green-500 mr-2">phone</span>
                <h3 class="font-medium text-gray-900 dark:text-white">Phone</h3>
              </div>
              <p class="text-sm text-gray-600 dark:text-gray-300">+216 93 06 68 03</p>
              <p class="text-sm text-gray-500 dark:text-gray-400 mt-1">Mon-Fri, 9:00 AM - 5:00 PM</p>
            </div>
            
            <div class="bg-gray-50 dark:bg-gray-700 p-4 rounded-lg">
              <div class="flex items-center mb-3">
                <span class="material-symbols-outlined text-purple-500 mr-2">location_on</span>
                <h3 class="font-medium text-gray-900 dark:text-white">Location</h3>
              </div>
              <p class="text-sm text-gray-600 dark:text-gray-300">Compus Manar</p>
              <p class="text-sm text-gray-500 dark:text-gray-400 mt-1">Fac Des Sciences Tunis</p>
            </div>
          </div>
        </div>
      </div>

      <!-- Contact Form -->
      <div class="bg-white dark:bg-gray-800 shadow overflow-hidden sm:rounded-lg">
        <div class="px-4 py-5 sm:px-6">
          <h2 class="text-lg leading-6 font-medium text-gray-900 dark:text-white">Contact Form</h2>
          <p class="mt-1 max-w-2xl text-sm text-gray-500 dark:text-gray-400">Send us a message and we'll get back to you as soon as possible.</p>
        </div>
        <div class="border-t border-gray-200 dark:border-gray-700 px-4 py-5 sm:p-6">
          <form id="contact-form">
            <div class="grid grid-cols-1 gap-y-6 gap-x-4 sm:grid-cols-2">
              <div>
                <label for="full-name" class="block text-sm font-medium text-gray-700 dark:text-gray-300">Full name</label>
                <div class="mt-1">
                  <input type="text" name="full-name" id="full-name" autocomplete="name" class="shadow-sm focus:ring-blue-500 focus:border-blue-500 block w-full sm:text-sm border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-white rounded-md">
                </div>
              </div>

              <div>
                <label for="email" class="block text-sm font-medium text-gray-700 dark:text-gray-300">Email</label>
                <div class="mt-1">
                  <input type="email" name="email" id="email" autocomplete="email" class="shadow-sm focus:ring-blue-500 focus:border-blue-500 block w-full sm:text-sm border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-white rounded-md">
                </div>
              </div>

              <div class="sm:col-span-2">
                <label for="subject" class="block text-sm font-medium text-gray-700 dark:text-gray-300">Subject</label>
                <div class="mt-1">
                  <input type="text" name="subject" id="subject" class="shadow-sm focus:ring-blue-500 focus:border-blue-500 block w-full sm:text-sm border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-white rounded-md">
                </div>
              </div>

              <div class="sm:col-span-2">
                <label for="message" class="block text-sm font-medium text-gray-700 dark:text-gray-300">Message</label>
                <div class="mt-1">
                  <textarea id="message" name="message" rows="5" class="shadow-sm focus:ring-blue-500 focus:border-blue-500 block w-full sm:text-sm border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-white rounded-md"></textarea>
                </div>
              </div>

              <div class="sm:col-span-2">
                <div class="flex items-start">
                  <div class="flex items-center h-5">
                    <input id="copy-to-email" name="copy-to-email" type="checkbox" class="focus:ring-blue-500 h-4 w-4 text-blue-600 border-gray-300 dark:border-gray-600 dark:bg-gray-700 rounded">
                  </div>
                  <div class="ml-3 text-sm">
                    <label for="copy-to-email" class="font-medium text-gray-700 dark:text-gray-300">Send me a copy of this message</label>
                  </div>
                </div>
              </div>
            </div>

            <div class="mt-6">
              <button type="submit" id="send-message-btn" class="inline-flex justify-center py-2 px-4 border border-transparent shadow-sm text-sm font-medium rounded-md text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500">
                <span class="material-symbols-outlined mr-2">send</span>
                Send Message
              </button>
            </div>
          </form>
        </div>
      </div>

      <!-- FAQs -->
      <div class="bg-white dark:bg-gray-800 shadow overflow-hidden sm:rounded-lg mt-6">
        <div class="px-4 py-5 sm:px-6">
          <h2 class="text-lg leading-6 font-medium text-gray-900 dark:text-white">Frequently Asked Questions</h2>
          <p class="mt-1 max-w-2xl text-sm text-gray-500 dark:text-gray-400">Common questions about the RFID Attendance System</p>
        </div>
        <div class="border-t border-gray-200 dark:border-gray-700">
          <dl>
            <div class="bg-gray-50 dark:bg-gray-700/50 px-4 py-5 sm:grid sm:grid-cols-3 sm:gap-4 sm:px-6">
              <dt class="text-sm font-medium text-gray-900 dark:text-white">What is the RFID Attendance System?</dt>
              <dd class="mt-1 text-sm text-gray-600 dark:text-gray-300 sm:mt-0 sm:col-span-2">
                The RFID Attendance System is an automated solution for tracking attendance using RFID cards. Students simply scan their cards when entering a classroom, and their attendance is automatically recorded.
              </dd>
            </div>
            
            <div class="bg-white dark:bg-gray-800 px-4 py-5 sm:grid sm:grid-cols-3 sm:gap-4 sm:px-6">
              <dt class="text-sm font-medium text-gray-900 dark:text-white">What if I forgot my RFID card?</dt>
              <dd class="mt-1 text-sm text-gray-600 dark:text-gray-300 sm:mt-0 sm:col-span-2">
                If you forget your RFID card, please inform your instructor or the attendance administrator. They can mark your attendance manually for that session. For repeated forgetfulness, you may need to visit the administration office.
              </dd>
            </div>
            
            <div class="bg-gray-50 dark:bg-gray-700/50 px-4 py-5 sm:grid sm:grid-cols-3 sm:gap-4 sm:px-6">
              <dt class="text-sm font-medium text-gray-900 dark:text-white">How do I report a lost RFID card?</dt>
              <dd class="mt-1 text-sm text-gray-600 dark:text-gray-300 sm:mt-0 sm:col-span-2">
                If you lose your RFID card, please report it immediately through the "Report" section in the menu or contact the administration office. A new card will be issued, and the old one will be deactivated to prevent misuse.
              </dd>
            </div>
            
            <div class="bg-white dark:bg-gray-800 px-4 py-5 sm:grid sm:grid-cols-3 sm:gap-4 sm:px-6">
              <dt class="text-sm font-medium text-gray-900 dark:text-white">Can I check my attendance history?</dt>
              <dd class="mt-1 text-sm text-gray-600 dark:text-gray-300 sm:mt-0 sm:col-span-2">
                Yes, you can view your complete attendance history through the "Dashboard" section. It provides detailed information about your attendance records, including dates, times, and attendance status for each class.
              </dd>
            </div>
            
            <div class="bg-gray-50 dark:bg-gray-700/50 px-4 py-5 sm:grid sm:grid-cols-3 sm:gap-4 sm:px-6">
              <dt class="text-sm font-medium text-gray-900 dark:text-white">What if there's an error in my attendance record?</dt>
              <dd class="mt-1 text-sm text-gray-600 dark:text-gray-300 sm:mt-0 sm:col-span-2">
                If you notice any discrepancies in your attendance record, please use the "Report" section to submit a correction request. Include the date, time, and class details for the attendance in question.
              </dd>
            </div>
          </dl>
        </div>
      </div>
    </div>
  </div>

  <!-- JavaScript for Firebase Authentication and Contact Form -->
  <script>
    // Firebase configuration
    const firebaseConfig = {
      apiKey: "AIzaSyAtj5j3xYmxRMOMR6ZOy8ucoqqhsD0jlZo",
      authDomain: "fdhf-4403b.firebaseapp.com",
      databaseURL: "https://fdhf-4403b-default-rtdb.firebaseio.com",
      projectId: "fdhf-4403b",
      storageBucket: "fdhf-4403b",
      messagingSenderId: "805654928789",
      appId: "1:805654928789:web:c7d541db0c1f92196e2a9c",
      measurementId: "G-KZNZ6JQ4FL",
    };

    // Initialize Firebase
    firebase.initializeApp(firebaseConfig);
    const auth = firebase.auth();
    const db = firebase.firestore();
    let currentUser = null;

    // DOM Elements
    const userMenuBtn = document.getElementById('user-menu-btn');
    const userMenuDropdown = document.getElementById('user-menu-dropdown');
    const logoutBtn = document.getElementById('logout-btn');
    const menuLogout = document.getElementById('menu-logout');
    const menuUserName = document.getElementById('menu-user-name');
    const menuUserEmail = document.getElementById('menu-user-email');
    const menuUserRole = document.getElementById('menu-user-role');
    const userAvatar = document.getElementById('user-avatar');
    const contactForm = document.getElementById('contact-form');
    const sendMessageBtn = document.getElementById('send-message-btn');

    // Authentication State Observer
    auth.onAuthStateChanged(function(user) {
      if (user) {
        currentUser = user;
        
        // Update user info in dropdown
        menuUserEmail.textContent = user.email;
        
        // Get user profile from Firestore
        db.collection('users').doc(user.uid).get()
          .then((doc) => {
            if (doc.exists) {
              const userData = doc.data();
              const fullName = userData.firstName && userData.lastName ? 
                `${userData.firstName} ${userData.lastName}` : user.displayName || user.email;
              
              menuUserName.textContent = fullName;
              menuUserRole.textContent = userData.role || 'Student';
              
              // Pre-fill contact form with user info
              document.getElementById('full-name').value = fullName;
              document.getElementById('email').value = user.email;
            }
          })
          .catch((error) => {
            console.error("Error getting user data:", error);
          });
      } else {
        // Redirect to login if not authenticated
        window.location.href = 'login.html';
      }
    });

    // Toggle dropdown menu
    userMenuBtn.addEventListener('click', function() {
      userMenuDropdown.classList.toggle('hidden');
    });

    // Close dropdown when clicking outside
    document.addEventListener('click', function(event) {
      if (userMenuBtn && userMenuDropdown && 
          !userMenuBtn.contains(event.target) && 
          !userMenuDropdown.contains(event.target)) {
        userMenuDropdown.classList.add('hidden');
      }
    });

    // Logout functionality
    function logoutUser() {
      auth.signOut()
        .then(() => {
          window.location.href = 'login.html';
        })
        .catch((error) => {
          console.error("Error signing out: ", error);
          showNotification('Error signing out', 'error');
        });
    }

    if (logoutBtn) logoutBtn.addEventListener('click', logoutUser);
    if (menuLogout) menuLogout.addEventListener('click', logoutUser);

    // Contact form submission
    contactForm.addEventListener('submit', function(event) {
      event.preventDefault();
      
      if (!currentUser) {
        showNotification('You must be logged in to send a message', 'error');
        return;
      }
      
      const fullName = document.getElementById('full-name').value.trim();
      const email = document.getElementById('email').value.trim();
      const subject = document.getElementById('subject').value.trim();
      const message = document.getElementById('message').value.trim();
      const sendCopy = document.getElementById('copy-to-email').checked;
      
      // Validate inputs
      if (!fullName || !email || !subject || !message) {
        showNotification('Please fill in all required fields', 'error');
        return;
      }
      
      // Disable button and show loading state
      sendMessageBtn.disabled = true;
      sendMessageBtn.innerHTML = '<span class="material-symbols-outlined animate-spin mr-2">sync</span>Sending...';
      
      // Prepare email parameters
      const emailParams = {
        from_name: fullName,
        from_email: email,
        to_email: 'islem.bousleh@etudiant-fst.utm.tn',
        subject: subject,
        message: message,
        reply_to: email,
        user_id: currentUser.uid
      };
      
      // Send email using EmailJS
      emailjs.send('service_oy1s3ik', 'template_k3j6iar', emailParams)
        .then(function() {
          // Success handling
          contactForm.reset();
          showNotification('Message sent successfully!', 'success');
          
          // Reset button state
          sendMessageBtn.disabled = false;
          sendMessageBtn.innerHTML = '<span class="material-symbols-outlined mr-2">send</span>Send Message';
        })
        .catch((error) => {
          console.error("Error sending message:", error);
          showNotification('Error sending message. Please try again later.', 'error');
          
          // Reset button state
          sendMessageBtn.disabled = false;
          sendMessageBtn.innerHTML = '<span class="material-symbols-outlined mr-2">send</span>Send Message';
        });
    });

    // Show notification
    function showNotification(message, type = 'info') {
      // Create notification element
      const notification = document.createElement('div');
      notification.className = 'fixed bottom-4 right-4 rounded-md shadow-lg p-4 max-w-md transform transition-all duration-300 ease-in-out translate-y-0';
      
      // Set background color based on type
      switch(type) {
        case 'success':
          notification.classList.add('bg-green-500', 'text-white');
          break;
        case 'error':
          notification.classList.add('bg-red-500', 'text-white');
          break;
        case 'warning':
          notification.classList.add('bg-yellow-500', 'text-white');
          break;
        default:
          notification.classList.add('bg-blue-500', 'text-white');
      }
      
      notification.innerHTML = `
        <div class="flex items-center">
          <div class="flex-shrink-0">
            <span class="material-symbols-outlined">${type === 'success' ? 'check_circle' : type === 'error' ? 'error' : type === 'warning' ? 'warning' : 'info'}</span>
          </div>
          <div class="ml-3">
            <p class="text-sm font-medium">${message}</p>
          </div>
          <div class="ml-auto pl-3">
            <button type="button" class="inline-flex text-white focus:outline-none">
              <span class="material-symbols-outlined">close</span>
            </button>
          </div>
        </div>
      `;
      
      // Add to document
      document.body.appendChild(notification);
      
      // Set up close button
      notification.querySelector('button').addEventListener('click', () => {
        notification.classList.add('opacity-0', '-translate-y-4');
        setTimeout(() => {
          notification.remove();
        }, 300);
      });
      
      // Auto-remove after 5 seconds
      setTimeout(() => {
        notification.classList.add('opacity-0', '-translate-y-4');
        setTimeout(() => {
          notification.remove();
        }, 300);
      }, 5000);
    }
  </script>
</body>
</html>